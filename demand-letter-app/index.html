<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dynamic Demand Letter</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.4; }
  label { display: inline-block; width: 180px; margin-top: 10px; }
  input { width: 250px; margin-bottom: 10px; }
  button { margin-top: 10px; padding: 5px 10px; }
  .sectionTitle { font-weight: bold; font-size: 14pt; text-align: center; margin-bottom: 10px; }
  .folioContainer {
    width: 612px;  
    height: 936px; 
    padding: 15px;
    border: 1px solid #000;
    box-sizing: border-box;
    font-family: Arial, sans-serif;
    font-size: 11pt;   
    white-space: pre-wrap;
    overflow-wrap: break-word;
    margin: 0 auto 20px auto;
    line-height: 1.4;
  }
  .boldText { font-weight: bold; }

  @media print {
    body * { visibility: hidden; }
    #letterPrintContainer { visibility: visible; position: absolute; left: 0; top: 0; width: 100%; }
  }
</style>
</head>
<body>

<h2>Dynamic Demand Letter</h2>

<div id="inputSection">
  <label>Borrower Name:</label>
  <input type="text" id="borrower" value="Atty. Marian Kanna Motoomull Idulsa"><br>
  <label>Lender Name:</label>
  <input type="text" id="lender" value="Cyprus Luck Dominic Rodriguez"><br>
  <label>Outstanding Balance (₱):</label>
  <input type="number" id="balance" value="210000"><br>
  <label>Number of Days to Comply:</label>
  <input type="number" id="days" value="7"><br>
  <label>Date of Default:</label>
  <input type="date" id="defaultDate" value=""><br>
  <button onclick="generateLetter()">Generate Demand Letter</button>
  <button onclick="downloadPDF()">Download PDF</button>
  <button onclick="printLetter()">Print</button>
</div>

<div id="letterPrintContainer">
  <div class="folioContainer" id="letterContainer">
    <div id="letterTitle" class="sectionTitle">DEMAND LETTER</div>
    <div id="demandLetter"></div>
  </div>
</div>

<script>
function formatCurrency(amount) {
  return "₱" + parseFloat(amount).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
}

function generateLetter() {
  const borrower = document.getElementById('borrower').value;
  const lender = document.getElementById('lender').value;
  const balance = parseFloat(document.getElementById('balance').value);
  const days = parseInt(document.getElementById('days').value);
  const defaultDateInput = document.getElementById('defaultDate').value;
  const defaultDate = defaultDateInput ? new Date(defaultDateInput).toLocaleDateString() : new Date().toLocaleDateString();

  const letterContent = `
Date: ${defaultDate}

TO: ${borrower}

Dear ${borrower},

This Demand Letter serves as formal notice that you are in default of your repayment obligations under the Promissory Note executed between you and ${lender}. As of ${defaultDate}, your outstanding balance due amounts to ${formatCurrency(balance)}.

In accordance with the terms of the Promissory Note, you are hereby required to settle the above-mentioned outstanding balance in full within ${days} calendar days from receipt of this notice.

Failure to comply with this demand within the specified period shall compel ${lender} to initiate legal proceedings to recover the full amount due, together with accrued interest, penalties, and legal costs, without further notice.

This Demand Letter is issued without prejudice to any of ${lender}'s rights and remedies under the law and the Promissory Note.

Sincerely,

_____________________________
${lender}
Lender

Acknowledgment of Receipt:

_____________________________
${borrower}
Borrower
  `;

  const letterHtml = letterContent
    .replace(new RegExp(`\\b${borrower}\\b`, 'g'), `<span class="boldText">${borrower}</span>`)
    .replace(new RegExp(`\\b${lender}\\b`, 'g'), `<span class="boldText">${lender}</span>`)
    .replace(new RegExp(formatCurrency(balance), 'g'), `<span class="boldText">${formatCurrency(balance)}</span>`);

  document.getElementById('demandLetter').innerHTML = letterHtml;
}

async function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({ unit: "pt", format: [612, 936] });
  const margin = 15;
  const pageWidth = pdf.internal.pageSize.getWidth() - 2 * margin;

  const container = document.getElementById('letterContainer').cloneNode(true);
  const hiddenDiv = document.createElement('div');
  hiddenDiv.style.position = 'absolute';
  hiddenDiv.style.left = '-9999px';
  hiddenDiv.appendChild(container);
  document.body.appendChild(hiddenDiv);

  const canvas = await html2canvas(container, { scale: 2 });
  const data = canvas.toDataURL('image/png');
  const props = pdf.getImageProperties(data);
  const height = (props.height * pageWidth) / props.width;

  pdf.addImage(data, 'PNG', margin, margin, pageWidth, height);
  document.body.removeChild(hiddenDiv);
  pdf.save("Demand_Letter.pdf");
}

function printLetter() {
  window.print();
}

// Set default date as today
document.getElementById('defaultDate').valueAsDate = new Date();
</script>

</body>
</html>
